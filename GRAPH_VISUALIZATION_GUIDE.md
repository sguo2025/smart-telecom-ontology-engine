# 🔗 知识图谱可视化功能

## 功能概述

知识图谱可视化功能提供了一个交互式的图形界面，用于查看和探索 Neo4j 数据库中存储的 RDF 数据。该功能使用力导向布局算法实时渲染节点和关系，支持拖拽、缩放和节点详情查看。

## 主要特性

### ✨ 核心功能

1. **实时可视化**
   - 自动从 Neo4j 加载图数据
   - 力导向布局算法动态调整节点位置
   - 支持最多 500 个节点和 1000 个关系的渲染

2. **交互操作**
   - 🖱️ 拖拽节点调整位置
   - 👆 点击节点查看详情
   - 🔍 搜索特定节点
   - 🔄 实时刷新图数据

3. **节点分类着色**
   - 🔵 类 (Class) - 蓝色
   - 🟢 属性 (Property) - 绿色
   - 🔴 实例 (Individual) - 红色
   - 🟣 本体 (Ontology) - 紫色
   - 🟠 其他 - 橙色

4. **信息面板**
   - 📊 图统计（节点数、关系数）
   - 🎨 图例说明
   - 📋 节点详情展示

## 使用指南

### 访问方式

1. **通过 Web UI**
   - 访问: http://localhost:8888
   - 点击顶部导航栏的「🔗 知识图谱」标签

2. **直接访问 Neo4j Browser**
   - 访问: http://localhost:7474
   - 使用 Cypher 查询语言进行更高级的查询

### 基本操作

#### 1. 加载图数据

```
点击右上角「🔄 刷新」按钮
系统会从 Neo4j 加载所有节点和关系
```

#### 2. 拖拽节点

```
1. 鼠标左键点击并按住节点
2. 拖动到目标位置
3. 松开鼠标完成定位
```

#### 3. 查看节点详情

```
1. 点击任意节点
2. 左侧面板会显示节点的完整信息：
   - ID (节点标识符)
   - 标签 (节点类型)
   - 属性 (键值对)
```

#### 4. 搜索节点

```
1. 在右上角搜索框中输入关键词
2. 按 Enter 键或点击 🔍 按钮
3. 系统会查找并高亮匹配的节点
```

### 高级功能

#### API 调用

**获取图数据**
```bash
curl http://localhost:8080/api/rdf/graph-data | jq .
```

**响应格式**
```json
{
  "nodes": [
    {
      "id": "http://example.com/ont#Customer",
      "labels": ["Class"],
      "properties": {
        "iri": "http://example.com/ont#Customer",
        "label": "客户",
        "comment": "业务参与主体"
      }
    }
  ],
  "relationships": [
    {
      "source": "http://example.com/ont#Manager",
      "target": "http://example.com/ont#Employee",
      "type": "SUBCLASSOF"
    }
  ]
}
```

## 使用场景

### 场景 1: 本体结构分析

```
1. 导入本体文件到 Neo4j
2. 切换到「知识图谱」视图
3. 观察类的层次结构
4. 点击节点查看属性和关系
5. 理解本体的整体架构
```

### 场景 2: 实例数据探索

```
1. 导入实例数据（包含个体）
2. 刷新图谱视图
3. 查看实例如何关联到类
4. 追踪实例之间的关系链
5. 验证数据完整性
```

### 场景 3: 推理结果验证

```
1. 执行推理操作（在推理引擎中）
2. 推理结果保存到 Neo4j
3. 切换到知识图谱
4. 查看新增的推理三元组
5. 验证推理的正确性
```

### 场景 4: 数据质量检查

```
1. 加载图数据
2. 搜索孤立节点（无关系的节点）
3. 检查节点属性的完整性
4. 识别异常的关系模式
5. 发现潜在的数据问题
```

## 技术细节

### 力导向布局算法

系统使用简化的力导向算法进行节点布局：

1. **排斥力**: 节点之间相互排斥，避免重叠
   ```
   力 = 1000 / (距离²)
   ```

2. **引力**: 有关系的节点相互吸引
   ```
   力 = (距离 - 理想距离) × 0.01
   ```

3. **中心引力**: 所有节点向画布中心靠拢
   ```
   力 = (中心距离) × 0.001
   ```

4. **阻尼**: 速度衰减，使布局逐渐稳定
   ```
   速度 = 速度 × 0.85
   ```

### 性能优化

- **节点限制**: 最多显示 500 个节点
- **关系限制**: 最多显示 1000 个关系
- **动画优化**: 使用 requestAnimationFrame
- **边界检测**: 防止节点移出画布

### 数据结构

**节点对象**
```javascript
{
  id: "http://example.com/ont#Customer",
  labels: ["Class"],
  properties: {
    iri: "...",
    label: "客户",
    comment: "..."
  },
  x: 600,  // 画布坐标
  y: 350,
  vx: 0,   // 速度
  vy: 0,
  radius: 20
}
```

**关系对象**
```javascript
{
  source: nodeObject,  // 源节点引用
  target: nodeObject,  // 目标节点引用
  type: "SUBCLASSOF"
}
```

## 常见问题

### Q: 图谱显示空白或无数据？

**原因**: Neo4j 中没有数据

**解决**:
1. 切换到「📊 RDF 管理」标签
2. 导入示例数据或自定义 RDF 数据
3. 确认导入成功
4. 返回「🔗 知识图谱」并刷新

### Q: 节点太多，画布很乱？

**原因**: 数据量过大，节点重叠

**解决**:
1. 多次拖拽节点，手动调整布局
2. 使用搜索功能聚焦特定节点
3. 考虑过滤数据，只导入关键部分
4. 使用 Neo4j Browser 进行更精确的查询

### Q: 无法拖动节点？

**原因**: 浏览器兼容性或性能问题

**解决**:
1. 确保使用现代浏览器（Chrome/Edge/Firefox）
2. 清除浏览器缓存并刷新
3. 检查控制台是否有 JavaScript 错误
4. 尝试减少显示的节点数量

### Q: 关系标签显示不全？

**原因**: 关系类型名称过长

**解决**:
1. 系统会自动截取最后一部分显示
2. 点击相关节点查看完整关系信息
3. 使用 Neo4j Browser 查询完整数据

### Q: 节点颜色含义？

**说明**: 根据节点的 label 自动分配颜色

- 蓝色 (#3498db): 包含 "class" 的标签
- 绿色 (#2ecc71): 包含 "property" 的标签
- 红色 (#e74c3c): 包含 "individual" 或 "instance" 的标签
- 紫色 (#9b59b6): 包含 "ontology" 的标签
- 橙色 (#f39c12): 其他标签

### Q: 如何导出图谱截图？

**方法 1**: 浏览器截图
```
1. 按 F11 进入全屏模式
2. 按 PrintScreen 截取屏幕
3. 粘贴到图像编辑器保存
```

**方法 2**: 浏览器开发者工具
```
1. 右键点击画布 → 检查
2. 在开发者工具中找到 <canvas> 元素
3. 右键 → 捕获节点屏幕截图
```

## 键盘快捷键

当前版本暂不支持键盘快捷键，但计划在未来版本中添加：

- `Ctrl + F`: 快速搜索
- `Ctrl + R`: 刷新图数据
- `Space`: 暂停/恢复布局动画
- `Ctrl + +/-`: 缩放画布
- `Ctrl + 0`: 重置视图

## 与其他功能集成

### 与 RDF 管理集成

```
流程: RDF 管理 → 导入数据 → Neo4j → 图谱可视化
```

1. 在「📊 RDF 管理」中导入 Turtle/RDF/XML 数据
2. 数据自动存储到 Neo4j
3. 切换到「🔗 知识图谱」查看可视化结果

### 与推理引擎集成

```
流程: 推理引擎 → 执行推理 → 保存结果 → 图谱查看
```

1. 在「🧠 推理引擎」中执行推理
2. 勾选「推理后保存到 Neo4j」
3. 推理结果（新三元组）写入 Neo4j
4. 切换到「🔗 知识图谱」查看推理后的完整图谱

### 与 Neo4j Browser 协同

```
互补使用: 简单查看用可视化，复杂查询用 Neo4j Browser
```

**知识图谱可视化**
- ✅ 快速预览整体结构
- ✅ 交互式拖拽和探索
- ✅ 节点详情快速查看

**Neo4j Browser**
- ✅ 精确的 Cypher 查询
- ✅ 复杂的路径分析
- ✅ 高级过滤和聚合

## 未来增强计划

### 📅 计划中的功能

1. **多种布局算法**
   - 树形布局
   - 圆形布局
   - 分层布局
   - 自定义布局

2. **高级交互**
   - 画布缩放（鼠标滚轮）
   - 平移（拖拽背景）
   - 框选多个节点
   - 节点分组

3. **数据过滤**
   - 按标签过滤节点
   - 按关系类型过滤
   - 深度限制（只显示 N 跳以内）
   - 自定义过滤规则

4. **导出功能**
   - 导出为 PNG/SVG 图片
   - 导出为 Cypher 查询
   - 导出选中的子图

5. **性能优化**
   - 虚拟化渲染（只渲染可见区域）
   - WebGL 加速
   - 支持更大规模图谱（1000+ 节点）

## 技术栈

- **前端框架**: React 18
- **Canvas 绘图**: HTML5 Canvas API
- **布局算法**: 自定义力导向算法
- **后端 API**: Spring Boot REST
- **数据库**: Neo4j 5.x
- **数据格式**: JSON

## 相关资源

- [Neo4j Browser 文档](http://localhost:7474)
- [Cypher 查询语言](https://neo4j.com/docs/cypher-manual/)
- [RDF 管理功能](./README_FULL.md#rdf-管理)
- [推理引擎功能](./REASONING_GUIDE.md)

---

**提示**: 如需更高级的图谱分析和可视化功能，推荐使用专业的图数据库可视化工具如 Neo4j Bloom 或 Gephi。
